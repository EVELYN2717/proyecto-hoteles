@if (hotel(); as h) {
  @if (room(); as r) {
    <div class="page-container">
      <a [routerLink]="['/traveler/hotel', h.id]" class="back-link">&larr; Volver al hotel</a>

      <div class="booking-layout">
        <div class="booking-main">
          <h2>Datos del Huésped</h2>

          <form [formGroup]="guestForm" class="card">
            <div class="form-grid">
              <div class="form-group full-width">
                <label>Nombre completo *</label>
                <input formControlName="fullName" placeholder="Nombre y apellido" />
                <span class="error-message" [class.visible]="isFieldInvalid(guestForm, 'fullName')">Mínimo 3 caracteres</span>
              </div>

              <div class="form-group">
                <label>Fecha de nacimiento *</label>
                <input type="date" formControlName="birthDate" />
                <span class="error-message" [class.visible]="isFieldInvalid(guestForm, 'birthDate')">Campo requerido</span>
              </div>

              <div class="form-group">
                <label>Género *</label>
                <select formControlName="gender">
                  <option value="" disabled>Seleccionar</option>
                  <option value="male">Masculino</option>
                  <option value="female">Femenino</option>
                  <option value="other">Otro</option>
                </select>
                <span class="error-message" [class.visible]="isFieldInvalid(guestForm, 'gender')">Campo requerido</span>
              </div>

              <div class="form-group">
                <label>Tipo de documento *</label>
                <select formControlName="documentType">
                  <option value="" disabled>Seleccionar</option>
                  <option value="cc">Cédula de Ciudadanía</option>
                  <option value="ce">Cédula de Extranjería</option>
                  <option value="passport">Pasaporte</option>
                </select>
                <span class="error-message" [class.visible]="isFieldInvalid(guestForm, 'documentType')">Campo requerido</span>
              </div>

              <div class="form-group">
                <label>Número de documento *</label>
                <input formControlName="documentNumber" placeholder="Número" />
                <span class="error-message" [class.visible]="isFieldInvalid(guestForm, 'documentNumber')">Mínimo 5 caracteres</span>
              </div>

              <div class="form-group">
                <label>Email *</label>
                <input type="email" formControlName="email" placeholder="correo@ejemplo.com" />
                <span class="error-message" [class.visible]="isFieldInvalid(guestForm, 'email')">Email inválido</span>
              </div>

              <div class="form-group">
                <label>Teléfono *</label>
                <input formControlName="phone" placeholder="300 123 4567" />
                <span class="error-message" [class.visible]="isFieldInvalid(guestForm, 'phone')">Mínimo 7 caracteres</span>
              </div>
            </div>
          </form>

          <h2 class="section-title">Contacto de Emergencia</h2>

          <form [formGroup]="emergencyForm" class="card">
            <div class="form-grid">
              <div class="form-group">
                <label>Nombre completo *</label>
                <input formControlName="fullName" placeholder="Nombre y apellido" />
                <span class="error-message" [class.visible]="isFieldInvalid(emergencyForm, 'fullName')">Mínimo 3 caracteres</span>
              </div>
              <div class="form-group">
                <label>Teléfono *</label>
                <input formControlName="phone" placeholder="300 123 4567" />
                <span class="error-message" [class.visible]="isFieldInvalid(emergencyForm, 'phone')">Mínimo 7 caracteres</span>
              </div>
            </div>
          </form>
        </div>

        <aside class="booking-sidebar">
          <div class="card summary-card">
            <h3>Resumen de Reserva</h3>
            <div class="summary-item">
              <span class="summary-label">Hotel</span>
              <span class="summary-value">{{ h.name }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Ciudad</span>
              <span class="summary-value">{{ h.city }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Habitación</span>
              <span class="summary-value type-badge">{{ r.type }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Ubicación</span>
              <span class="summary-value">{{ r.location }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Capacidad</span>
              <span class="summary-value">{{ r.capacity }} persona(s)</span>
            </div>

            <div class="summary-divider"></div>

            <div class="summary-item">
              <span class="summary-label">Costo base</span>
              <span class="summary-value">{{ r.baseCost | currency:'COP':'symbol-narrow':'1.0-0' }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Impuestos</span>
              <span class="summary-value">{{ r.taxes | currency:'COP':'symbol-narrow':'1.0-0' }}</span>
            </div>
            <div class="summary-item total">
              <span class="summary-label">Total</span>
              <span class="summary-value">{{ totalCost | currency:'COP':'symbol-narrow':'1.0-0' }}</span>
            </div>

            <button
              class="btn btn--primary confirm-btn"
              [disabled]="guestForm.invalid || emergencyForm.invalid"
              (click)="onSubmit()"
            >
              Confirmar Reserva
            </button>
          </div>
        </aside>
      </div>
    </div>
  }
}
